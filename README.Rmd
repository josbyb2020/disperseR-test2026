---
title: "disperseR"
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

<!-- README.md is generated from README.Rmd. Please edit that file -->

# disperseR 0.2.0

Run HYSPLIT many times in parallel and aggregate exposure to ZIP code level.
This fork modernizes the spatial stack (sf/terra) and keeps compatibility with
current R.

## Highlights

- Modern spatial stack (sf, terra) and cleaned dependencies
- Parallel execution with OS-aware strategy
- Built-in helpers for data download, linking, and exposure metrics

## Installation

Not on CRAN. Install from GitHub:

```{r, eval = FALSE}
install.packages("remotes")
remotes::install_github("josbyb2020/disperseR-test2026")
```

If you plan to run HYSPLIT (dispersion or trajectories) or use GDAS1 meteorology:

```{r, eval = FALSE}
remotes::install_github("rich-iannone/SplitR")
```

Windows users who build vignettes will need Rtools.

## Quick start

```{r, eval = FALSE}
library(disperseR)

create_dirs(location = "~/disperseR_project")

get_data(
  data = "all",
  start.year = "2005",
  start.month = "01",
  end.year = "2005",
  end.month = "12"
)

check_spatial_packages()
```

## Project layout

- `main/input/zcta_500k`: ZCTA shapefile
- `main/input/hpbl`: PBL height data
- `main/input/meteo`: reanalysis meteorology files
- `main/output/hysplit`: dispersion outputs
- `main/output/ziplinks`: linked ZIP code outputs
- `main/output/rdata`: HyADS matrices
- `main/output/exp`: exposure tables
- `main/output/graph`: plots

## Data requirements

- ZCTA shapefile
- ZCTA to ZIP crosswalk (included)
- NOAA reanalysis meteorology files
- Planetary boundary layer height data
- Units data (included for 1995-2017)

Use `get_data()` to download most inputs automatically.

## Cross-platform notes

- `create_dirs()` defaults to Desktop when available and falls back to the home
  directory. Pass an explicit path on Windows or network drives.
- HYSPLIT binaries are provided by SplitR for macOS, Linux, and Windows; you can
  point to a custom binary via `binary_path` or `exec_dir`.
- Windows uses socket clusters (`parLapply`). Set `mc.cores` to control parallelism.

## Documentation

- Main vignette: `vignette("Vignette_DisperseR")`
- Migration guide: `?migration_guide`
- Additional vignettes in `vignettes/` (render with `rmarkdown::render()`)

## System requirements

- R >= 4.1.0
- sf >= 1.0-0
- terra >= 1.7-0
- Network access for meteorology downloads

## Citation

```
Henneman, L., Choirat, C., & Garbulinska, M. (2019). disperseR:
Run HYSPLIT many times in parallel, aggregate to zip code level.
R package version 0.2.0. https://github.com/lhenneman/disperseR
```
