% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_exposure.R
\name{calculate_exposure}
\alias{calculate_exposure}
\title{Calculate exposure from linked HYSPLIT outputs}
\usage{
calculate_exposure(
  year.E,
  year.D,
  link.to = "zips",
  pollutant = "SO2..tons.",
  units.mo = NULL,
  monthly_maps = NULL,
  rda_file = NULL,
  exp_dir = NULL,
  source.agg = c("total", "facility", "unit"),
  time.agg = c("year", "month"),
  return.monthly.data = FALSE,
  allow.partial = FALSE
)
}
\arguments{
\item{year.E}{Numeric. Emissions year.}

\item{year.D}{Numeric. HYSPLIT dispersion year.}

\item{link.to}{Character. Spatial scale: 'zips', 'counties', or 'grids'.
Must match the original input to `link_all_units()`.}

\item{pollutant}{Character. Column name in `units.mo` for emissions weighting.
Default: 'SO2..tons.'.}

\item{units.mo}{Data.frame or data.table with monthly unit emissions data.
Must contain columns: uID, year, month, and the pollutant column.
If NULL, attempts to use `PP.units.monthly1995_2017` from the disperseR
cache (set by get_data()).}

\item{monthly_maps}{Named list of monthly MAP data.tables from 
`combine_monthly_links()`. Names should be in format "MAP\{month\}.\{year\}".
If NULL, attempts to load from `rda_file`.}

\item{rda_file}{Character. Path to RData file from `combine_monthly_links()`.
Only used if `monthly_maps` is NULL. Default: NULL.}

\item{exp_dir}{Character. Directory to save exposure output. If NULL, uses
the cached exp_dir from create_dirs() when available, otherwise the
current working directory.}

\item{source.agg}{Character. Source aggregation: 'total', 'facility', or 'unit'.}

\item{time.agg}{Character. Time aggregation: 'year' or 'month'.}

\item{return.monthly.data}{Logical. Return monthly data when time.agg='month'?}

\item{allow.partial}{Logical. If FALSE (default), errors when any monthly maps
are missing. If TRUE, warns and continues with available data.}
}
\value{
A data.table with exposure values aggregated by the specified levels.
  If \code{allow.partial = TRUE} and some months were missing, the result
  has an attribute "missing_maps" listing the skipped months.
}
\description{
Takes linked HYSPLIT outputs combined using 
`disperseR::combine_monthly_links()` and sums them by emissions. Results 
can be aggregated to three source levels and two time scales.
}
