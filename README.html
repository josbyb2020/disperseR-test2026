<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="disperser">disperseR</h1>
<!-- README.md is generated from README.Rmd. Please edit that file -->

<h1 id="disperser-021">disperseR 0.2.1</h1>
<p>Run HYSPLIT many times in parallel and aggregate exposure to ZIP code
level.</p>
<h2 id="what-is-this">What is this?</h2>
<p>disperseR implements the HyADS (HYSPLIT Average Dispersion)
methodology for estimating population exposure to air pollution from
point sources (like power plants). It runs the HYSPLIT atmospheric
dispersion model, links trajectories to geographic areas, and calculates
exposure metrics.</p>
<h2 id="first-time-setup-5-10-minutes">First-time setup (5-10
minutes)</h2>
<h3 id="step-1-install-r-packages">Step 1: Install R packages</h3>
<p>Open R or RStudio and run:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Install disperseR from GitHub</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;josbyb2020/disperseR-test2026&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># Install splitr (provides HYSPLIT binaries)</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;rich-iannone/splitr&quot;</span>)</span></code></pre></div>
<h3 id="step-2-platform-specific-setup">Step 2: Platform-specific
setup</h3>
<p><strong>Check your platform first:</strong></p>
<ul>
<li><strong>Windows</strong>: No extra steps needed.</li>
<li><strong>macOS Intel</strong> (pre-2020 Macs): No extra steps
needed.</li>
<li><strong>macOS Apple Silicon</strong> (M1/M2/M3/M4 chips, 2020+): See
below.</li>
<li><strong>Linux</strong>: Install GDAL/GEOS/PROJ (see below).</li>
</ul>
<h4 id="macos-apple-silicon">macOS Apple Silicon</h4>
<p>The HYSPLIT binaries in splitr are compiled for Intel. Install
Rosetta to run them:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">softwareupdate</span> <span class="at">--install-rosetta</span></span></code></pre></div>
<h4 id="linux">Linux</h4>
<p>Install system libraries for sf and terra:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Ubuntu/Debian</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">sudo</span> apt install libgdal-dev libgeos-dev libproj-dev</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Fedora/RHEL</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">sudo</span> dnf install gdal-devel geos-devel proj-devel</span></code></pre></div>
<h3 id="step-3-create-a-project-and-download-data">Step 3: Create a
project and download data</h3>
<p>Back in R:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(disperseR)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># Create project directories (do this at the start of EVERY R session)</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>dirs <span class="ot">&lt;-</span> <span class="fu">create_dirs</span>(<span class="at">location =</span> <span class="st">&quot;~/disperseR_project&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># Download all required data for 2005</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># This downloads ~500MB on first run, so it takes a few minutes</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">get_data</span>(</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="at">start.year =</span> <span class="st">&quot;2005&quot;</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="at">start.month =</span> <span class="st">&quot;01&quot;</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  <span class="at">end.year =</span> <span class="st">&quot;2005&quot;</span>,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="at">end.month =</span> <span class="st">&quot;12&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>)</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co"># Verify everything is ready</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="fu">check_spatial_packages</span>()</span></code></pre></div>
<p><strong>Windows users:</strong> Use a short path like
<code>C:/disperseR_project</code> to avoid Windows path length
limits.</p>
<h2 id="quick-example">Quick example</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">library</span>(disperseR)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># 1. Initialize (required every session)</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>dirs <span class="ot">&lt;-</span> <span class="fu">create_dirs</span>(<span class="st">&quot;~/disperseR_project&quot;</span>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># 2. Load units data and select top emitter</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>units_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(disperseR<span class="sc">::</span>units)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>test_unit <span class="ot">&lt;-</span> units_dt[year <span class="sc">==</span> <span class="dv">2005</span>][<span class="fu">order</span>(<span class="sc">-</span>SOx)][<span class="dv">1</span>]</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co"># 3. Define what to run</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>input_refs <span class="ot">&lt;-</span> <span class="fu">define_inputs</span>(</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="at">units =</span> test_unit,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="at">startday =</span> <span class="st">&quot;2005-01-15&quot;</span>,</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="at">endday =</span> <span class="st">&quot;2005-01-15&quot;</span>,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="at">start.hours =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">18</span>),</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="at">duration =</span> <span class="dv">120</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co"># 4. Run HYSPLIT dispersion</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>pbl <span class="ot">&lt;-</span> <span class="fu">get_data</span>(<span class="st">&quot;pblheight&quot;</span>)</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="fu">run_disperser_parallel</span>(</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  <span class="at">input.refs =</span> input_refs,</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="at">pbl.height =</span> pbl,</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>  <span class="at">species =</span> <span class="st">&quot;so2&quot;</span>,</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  <span class="at">mc.cores =</span> <span class="dv">1</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co"># 5. Check outputs</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="fu">validate_pipeline</span>()</span></code></pre></div>
<h2 id="common-issues">Common issues</h2>
<h3 id="splitr-not-found-or-hysplit-errors">“splitr not found” or
HYSPLIT errors</h3>
<p>Install splitr:
<code>remotes::install_github(&quot;rich-iannone/splitr&quot;)</code></p>
<p>On Apple Silicon Macs, also install Rosetta (see Step 2 above).</p>
<h3 id="object-not-found-after-restarting-r">“object not found” after
restarting R</h3>
<p>Run <code>create_dirs()</code> at the start of every R session.
disperseR caches paths in memory, so they’re lost when R restarts.</p>
<h3 id="windows-could-not-find-function-in-parallel-runs">Windows:
“could not find function” in parallel runs</h3>
<p>disperseR must be <em>installed</em> (not just loaded via
<code>devtools::load_all</code>). Either install it properly or use
<code>mc.cores = 1</code>.</p>
<h3 id="download-failures">Download failures</h3>
<p>If downloads fail (especially on Windows behind a proxy), try:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">download.file.method =</span> <span class="st">&quot;wininet&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># Then retry get_data() or get_met_reanalysis()</span></span></code></pre></div>
<h3 id="windows-runs-fail-mid-batch-or-hysplit-not-found">Windows: runs
fail mid-batch or HYSPLIT “not found”</h3>
<p>Windows Defender or corporate antivirus may flag rapid HYSPLIT
execution as suspicious (hundreds of .exe launches from temp
directories). Solutions:</p>
<ol style="list-style-type: decimal">
<li>Add the HYSPLIT binary folder to your antivirus exclusion list</li>
<li>Reduce <code>mc.cores</code> to slow down execution</li>
<li>Run <code>cleanup_hysplit_zombies()</code> to kill orphaned
processes from crashed runs</li>
</ol>
<h3 id="crs-or-projection-errors">CRS or projection errors</h3>
<p>Install system libraries for sf/terra: - macOS:
<code>brew install gdal geos proj</code> - Ubuntu:
<code>sudo apt install libgdal-dev libgeos-dev libproj-dev</code></p>
<h3 id="linux-libgfortranso3-not-found">Linux: libgfortran.so.3 not
found</h3>
<p>The HYSPLIT binaries bundled in splitr were compiled against an older
Fortran runtime (libgfortran.so.3). Modern Linux distros (Ubuntu 22.04+)
only ship libgfortran.so.5, which is not ABI-compatible.</p>
<p><strong>Solutions:</strong></p>
<ol style="list-style-type: decimal">
<li>Download and compile HYSPLIT from source at <a href="https://www.ready.noaa.gov/HYSPLIT.php">NOAA ARL</a>, then provide
<code>binary_path</code> and <code>parhplot_path</code> to bypass
splitr</li>
<li>Use a Docker container with an older distro</li>
<li>Check if your distro has a <code>libgfortran3</code> or
<code>compat-libgfortran</code> package</li>
</ol>
<p>This is a splitr issue, not a disperseR issue.</p>
<h2 id="project-structure">Project structure</h2>
<p>After running <code>create_dirs()</code> and <code>get_data()</code>,
your project looks like:</p>
<pre><code>disperseR_project/
  main/
    input/
      zcta_500k/     # ZCTA shapefile
      hpbl/          # Boundary layer height data
      meteo/         # Meteorology files (~120MB each)
    output/
      hysplit/       # Dispersion outputs (.fst files)
      ziplinks/      # Linked ZIP code data
      rdata/         # Combined monthly links
      exp/           # Exposure tables</code></pre>
<h2 id="learning-more">Learning more</h2>
<ul>
<li><strong>Main tutorial</strong>:
<code>vignette(&quot;Vignette_DisperseR&quot;)</code></li>
<li><strong>Function help</strong>:
<code>?run_disperser_parallel</code>, <code>?link_all_units</code>,
<code>?calculate_exposure</code></li>
<li><strong>Replication study</strong>: See the
<code>replication/</code> folder for a complete worked example</li>
</ul>
<h2 id="platform-support">Platform support</h2>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Status</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows 10/11</td>
<td>Supported</td>
<td>Use short paths; parallel uses socket clusters</td>
</tr>
<tr>
<td>macOS Intel</td>
<td>Supported</td>
<td>Works out of the box</td>
</tr>
<tr>
<td>macOS Apple Silicon</td>
<td>Supported</td>
<td>Requires Rosetta (see setup)</td>
</tr>
<tr>
<td>Linux x86_64</td>
<td>Supported</td>
<td>Install GDAL/GEOS/PROJ</td>
</tr>
<tr>
<td>Linux ARM</td>
<td>Partial</td>
<td>Need to supply your own HYSPLIT binaries</td>
</tr>
</tbody>
</table>
<h2 id="citation">Citation</h2>
<pre><code>Henneman, L., Choirat, C., &amp; Garbulinska, M. (2019). disperseR:
An R package for HYSPLIT dispersion modeling and ZIP code-level
exposure assessment. R package version 0.2.1.
https://github.com/josbyb2020/disperseR-test2026</code></pre>

</body>
</html>
